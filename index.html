<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="da-dk" lang="da-dk" dir="ltr">
	<head>
		<title>Apoint</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<script src="js/jquery-3.7.1.min.js"></script>
		<script src="js/userProfile.js"></script>
		
		<script src="js/calendar.js"></script>
		<script src="js/ajax.js"></script>
		<script src="js/timePicker.js"></script>
		<script src="js/chat.js"></script>
		
		<script src="js/render.js"></script>
		<script src="js/apiRequest.js"></script>
		<script src="js/eventHandlers.js"></script>
		
		<script>

			let profile = new userProfile();
			let msg_data = {};
			let error = 0;
			
			function getScreen()
			{
				let viewType = "fullscreen";
				const screenWidth = $(window).width();
			
				if(screenWidth<1000)
				{
					viewType = "phone";
				}
				return viewType;
			}
			
			function message(message)
			{
				$(".msg_box").text(message);
				if(message=="taken")
				{
					$("#account_email").css({"color":"#990000"});
					error = 1;
				}else{
					error = 0;
				}
			}

			function showMenu()
			{
				const display = $("#phone_menu").style.display();
				if(display == "block")
				{
					$("#menu_bar").hide();
					$("#login_btn").hide();
				}else{
					$("#menu_bar").show();
					$("#login_btn").show();
				}
			}

			function calendarList(calendars)
			{
				$("#calendar_list_view").html("");
				$.each(calendars, function(i, item) {
					let html = "<div class='calendar_box'>";
					html += "<a href='#calendar/" + item.id + "''>";
					html += "<div class='boxing'>" + item.title  + "</div></a>";
					html += "<div class='tab'><a href='#settings/" + item.id + "'><img src='images/icon_settings.png'></a></div>";
					$("#calendar_list_view").append(html);
				});
		
				let new_btn = "<div class='calendar_box'>";
				new_btn += "<div class='boxing' id='new_btn'>Create new calendar</div>";
				new_btn += "<div class='tab'></div></div>";

				$("#calendar_list_view").append(new_btn);
			}


			function settings(calendar)
			{
				if(calendar['valid'] == true)
				{
					$("#settings_c_url").html("<a href='#calendar/" + calendar['id'] + "'>apoint.dk#calendar/" + calendar['id'] + "</a>");
					$("#settings_c_type").html(calendar['type']);
					
					profile.setCalendarUsers(calendar['users']);

					let html = "";

					$("#settings_c_users").html("");
					html += "<table><tr><td>Users</td><td>Status</td><td></td></tr>";

					for(user of calendar['users'])
					{	
						if(user['id']!="")
						{
							html += "<tr><td>" + user['name'] + "</td><td>" + user['status'] + "</td>";
							html += "<td><div class='remove_user' data-id='" + user['id'] + "'><img src='images/delete.png'></div></td></tr>";
						}
					}
					for(pending_user of calendar['pending'])
					{	
						if(pending_user['id']!="")
						{
							html += "<tr><td>" + pending_user['name'] + "</td><td>" + pending_user['status'] + "</td>";
							html += "<td><div class='remove_pending' data-id='" + pending_user['id'] + "'><img src='images/delete.png'></div></td></tr>";
						}
					}
					html += "</table>";
					$("#settings_c_users").append(html);
					$("#settings_option").html("<div id='delete_calendar'>Delete calendar</div>");
					$("#settings_details").show();
				}else{
					$("#settings_c_url").html("");
					$("#settings_c_type").html("");
					$("#settings_details").hide();
					$("#settings_option").html("<div class='remove_user' data-id='" + profile.getID() + "'>leave calendar</a>");
				}
			}

			function urlPath(hash)
			{
				const path = hash.split("/");
				if(path.length == 2){
					renderPage(path[0],path[1]);
				}else{
					renderPage("goto",path[0]);
				}
				$(".msg_box").text("");
				profile.setRoute(hash);
			}
			
		</script>

		<link rel="stylesheet" type="text/css" href="css/main.css">
		<link rel="stylesheet" type="text/css" href="css/calendar.css">
		<link rel="stylesheet" type="text/css" href="css/timePicker.css">
		<link rel="stylesheet" type="text/css" href="css/phone.css">
		
	</head>
	<body>
	
	<div id="main">
		<div id="phone_menu"></div>
		<div id="menu_bar">
			<a>LOADING CONTENT</a>
		</div>
		<a href="#login" class="menu_link login_btn_a"><div id="login_btn">Login</div></a>
		<div id="content_body">
			<div class="content_div" id="home">
				<img src="images/logo.png">
				<p>Booking platform</p>
				<div class="divider"></div>
				<div class="btn_c2"><p>
					Opret dit eget gratis booking side i dag!</p> 
				</div>
				<a href="#new_account" class="menu_link">
					<div class="btn_c1">
						<p>Opret konto</p>
					</div>
				</a>
			</div>
			
			<div  class="content_div content_view" id="login">
				<div class="form_box">
					<h2>Login</h2>
					<table>
						<tr><td>E-mail: <br> <input id="login_email"></td></tr>
						<tr><td>password: <br> <input type="password" id="login_password"></td></tr>
						<tr><td><a class="forgot" href="#forgot_password">Glemt password?</a></td></tr>
						
						<tr><td style="text-align: right"><input class="submit_btn" data-action="login" type="button" value="login"></td></tr>
					</table>
				</div>
			</div>

			<div class="content_div content_view" id="forgot_password">
				<div class="form_box">
					<h2>Glemt password?</h2>
					<p>Skriv din e-mail i feltet fornede, og vi sender en mail med et link til nulstilling af dit password.
					<table>
						<tr><td>E-mail: <br> <input id="reset_email"></td></tr>
						<tr><td style="text-align: right"><input class="submit_btn" data-action="reset" type="button" value="Nulstil"></td></tr>
					</table>
				</div>
			</div>


			<div class="content_div content_view" id="settings_view">
				<div>
					<table id="settings_details">
						<tr><td class="td1">Kalendar URL:</td><td><div id="settings_c_url"></div></td></tr>
						<tr><td class="td1">Kalendar type:</td><td><div id="settings_c_type"></div></td></tr>
						<tr><td class="td1">Brugere:</td><td><div id="settings_c_users"></div><a href="#adduser"><div>Add user</div></a></td></tr>
					</table>	
				</div>
				<div id="settings_option"></div>
			</div>

			<div class="content_div content_view" id="adduser">
				<h2>TIlføj brugere til kalendaren:</h2>
				
				<div class="form_box">
					<h2>Oplysninger</h2>
					<table>
						<tr><td>E-mail:<br><input id="add_user_email"></td></tr>
						<tr><td style="text-align: right"><input class="submit_btn" data-action="add_user" type="button" value="Send request"></td></tr>
					</table>
				</div>

			</div>

			<div class="content_div content_view" id="calendars">
				<div id="calendar_list_view">

				</div>
			</div>

			<div class="content_div content_view" id="messages">
				
				<div id="message_list">
					loading
				</div>
				
				<div id="send_massage">
					<div class="form_box">
						<table width="100%">
							<tr><td>
									<textarea id="msg"></textarea>
							</td></tr>
							<tr><td style="text-align: right">
								<input class="submit_btn" data-action="send_message" type="button" value="Send">		
							</td></tr>
						</table>
					</div>
				</div>
			</div>

			<div  class="content_div content_view" id="new_account">
				<div class="form_box">
					<h2>Opret ny bruger</h2>
					<table>
						<tr><td> E-mail: <br> <input id="account_email"></td></tr>
						<tr><td> password: <br> <input type="password" id="account_password"></td><span class="msg_box"></span></tr>
						<tr><td> Brugernavn: <br> <input id="account_username"></td></tr>
						<tr><td style="text-align: right"><input class="submit_btn" data-action="new_account" type="button" value="Opret"></td></tr>
					</table>
				</div>
			</div>

			<div  class="content_div content_view" id="calendar">
				<div id="calendar_box">
					<div id="calendar_wrapper">
						<div id="cal_top_header">
							<div id="prev">Tilbage</div>
								Kalendar
							<div id="next">Frem</div>
						</div>
						<div id="first_month">
							<div id="first_date" class="header"></div>
							<div class="dayPickerEmty topRow">Man</div>
							<div class="dayPickerEmty topRow">Tirs</div>
							<div class="dayPickerEmty topRow">Ons</div>
							<div class="dayPickerEmty topRow">Tors</div>
							<div class="dayPickerEmty topRow">Fre</div>
							<div class="dayPickerEmty topRow">Lør</div>
							<div class="dayPickerEmty topRow">Søn</div>	
							<div id="first_month_picker"></div>
						</div>
						<div id="second_month">
							<div id="second_date" class="header"></div>
							<div class="dayPickerEmty topRow">Man</div>
							<div class="dayPickerEmty topRow">Tirs</div>
							<div class="dayPickerEmty topRow">Ons</div>
							<div class="dayPickerEmty topRow">Tors</div>
							<div class="dayPickerEmty topRow">Fre</div>
							<div class="dayPickerEmty topRow">Lør</div>
							<div class="dayPickerEmty topRow">SØn</div>
							<div id="second_month_picker"></div>
						</div>
						<div class="break">
							<input type="hidden" id="startDate" value="">
							<input type="hidden" id="endDate" value="">
						</div>
						<input class="submit_btn btn" data-action="save_dates" type="button" value="Save">
					</div>
					<div id="calendar_info_box">
						<div id="calendar_info_close_btn">x</div>
						<h1>Reserveret</h1>
						<table>
							<tr>
								<td>Bruger:</td><td><span id="calendar_info_box_user"></span></td>
							</tr>
							<tr>
								<td>Start:</td><td><span id="calendar_info_box_start"></span></td>
							</tr>
							<tr>
								<td>Slut:</td><td><span id="calendar_info_box_end"></span></td>
							</tr>
						</table>	
						<div class="send_msg_btn btn">Send Besked</div>
						<div class="btn btn_red" id="calendar_info_btn"></div>
					</div>
				</div>		
			</div>

			<div  class="content_div content_view" id="create_calendar">
				<div class="form_box">
					<table>
						<tr>
							<td>Kalendar navn:</td><td><input id="c_title"></td>
						</tr>
						<tr>
							<td>Kalendar type: </td><td>
								<select id="c_type">
									<option value="day">hel-dags booking</option>
									<option value="time">Time baseret booking</option>
								</select>
							</td>
						</tr>
						<tr>
							<td><span class="optional">Time interval</td><td>
								<span class="optional">
									<select id="c_interval">
										<option value="45">45 min</option>
										<option value="60">60 min</option>
										<option value="90">90 min</option>
										<option value="120">120 min</option>
									</select>
								</span>
							</td>
						</tr>
						<tr>
							<td colspan="2" style="text-align:right;">
								<input class="submit_btn" data-action="new_calendar" type="button" value="Create">
							</td>
						</tr>
					</table>
				</div>
			</div>

			<div  class="content_div content_view" id="mail_send">Oprettelses mail send til din e-mail. Følge linket i mailen for at gennemfører oprettelse.</div>
			
			<div  class="content_div content_view" id="error"><div id="error_msg"></div></div>
			
			<div  class="content_div content_view" id="load">LOADING...</div>

			<div  class="content_div content_view" id="profile">
				Under construction
			</div>

			<div  class="content_div content_view" id="time_picker">
				<div class="boxView">
					<div id="time_picker_cal">
						<div id="pick_date_btn"></div>
						<div id="small_calendar_wrapper">
							<div id="small_cal_top_header">
								<div id="small_cal_prev">Tilbage</div>
									<span id="small_cal_month_viewer">Kalendar</span>
								<div id="small_cal_next">Frem</div>
							</div>	
							<div id="small_calendar">
								<div id="cal_date_viewer" class="header"></div>
								<div class="smallDayPickerEmty topRow">Man</div>
								<div class="smallDayPickerEmty topRow">Tirs</div>
								<div class="smallDayPickerEmty topRow">Ons</div>
								<div class="smallDayPickerEmty topRow">Tors</div>
								<div class="smallDayPickerEmty topRow">Fre</div>
								<div class="smallDayPickerEmty topRow">Lør</div>
								<div class="smallDayPickerEmty topRow">Søn</div>	
								<div id="small_cal_month_picker"></div>
							</div>
						</div>
					</div>
					<div id="schedu_box">	
						<div id="time_line"></div>
						<div id="time_slots"></div>
					</div>
					
				</div>
				<div class="boxView">
					<div id="booking_list_view"></div>
					<div class="btn" id="view_time_list">Book</div>		
				</div>	

				<div id="time_slot_info_box">
					<div id="time_slot_info_close_btn">x</div>
					<h1>Reserveret</h1>
					<table>
						<tr>
							<td>Bruger:</td><td><span id="time_slot_info_box_user"></span></td>
						</tr>
						<tr>
							<td>Start:</td><td><span id="time_slot_info_box_start"></span></td>
						</tr>
						<tr>
							<td>Slut:</td><td><span id="time_slot_info_box_end"></span></td>
						</tr>
					</table>
					<div class="send_msg_btn btn">Send Besked</div>	
					<div id="time_slot_info_btn"></div>
				</div>

			</div>
		</div>
	</div>
		
	<div id="gdpr_banner">
		<p>bla bla bla. bla bla </p><div id="gdpr_ok">Accept</div>
	</div>
	</body>
</html>